(function(){var a,b,c,d,e,f,g=function(a,b){return function(){return a.apply(b,arguments)}},h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty,j=[].slice;f=function(){},d=function(){function b(b,d){switch(d=e.extend({},this.defaultOptions,d),d.type){case"checkbox":new c(b,d);break;case"radio":new c(b,d);break;case"calendar":new a(b,d);break;case"multi_calendar":new a(b,d)}}return b.prototype.defaultOptions={onFilterApplied:f,onFilterCleared:f},b.prototype.version="0.1.1",b}(),b=function(){function a(){this.closeFilters=g(this.closeFilters,this),this.openFilters=g(this.openFilters,this),this.elm=this.handleElm(),this.elm||console.warn("Slab couldn't initialize "+this.selector+" as it's not in the DOM")}return a.prototype.filtersShowing=!1,a.prototype.handleElm=function(){var a;return"string"==typeof this.selector?a=document.querySelector(this.selector):"object"==typeof this.selector&&this.selector.nodeName&&(a=this.selector),a},a.prototype.bindCommonPersistentEvents=function(){return this.filterButton.addEventListener("click",this.openFilters)},a.prototype.bindEvents=function(){return document.addEventListener("click",this.closeFilters)},a.prototype.unbindEvents=function(){return document.removeEventListener("click",this.closeFilters)},a.prototype.openFilters=function(a){return a.preventDefault(),this.bindEvents(),this.showFilters()},a.prototype.closeFilters=function(a){if($(a.target).parents(".sift-container").length<1)return this.hideFilters(),this.unbindEvents()},a.prototype.clearFilter=function(){return this.hideFilters(),this.options.onFilterCleared()},a.prototype.render=function(a,b){return a.innerHTML=b},a.prototype.handleTemplate=function(){return this.template='<a href="" class="sift-link">\n  <span class="sift-filter-name">'+this.options.displayName+'</span>\n  <span class="sift-active-filter-text"></span>\n</a>\n<div class="sift-dropdown">\n  <a href="" class="sift-clear">Clear filter</a>\n  <div class="sift-dropdown-inner"></div>\n</div>'},a.prototype.handleInitialRender=function(){return this.render(this.elm,this.template),this.filterButton=this.elm.querySelector(".sift-link"),this.filterName=this.elm.querySelector(".sift-filter-name"),this.activeFilterText=this.elm.querySelector(".sift-active-filter-text"),this.dropdown=this.elm.querySelector(".sift-dropdown"),this.clear=this.elm.querySelector(".sift-clear"),this.dropdownInner=this.elm.querySelector(".sift-dropdown-inner"),e.addClass("sift-container",this.elm),this.bindCommonPersistentEvents()},a.prototype.showFilters=function(){return this.filtersShowing=!0,e.addClass("filters-showing",this.elm)},a.prototype.hideFilters=function(){return this.filtersShowing=!1,e.removeClass("filters-showing",this.elm)},a}(),c=function(a){function b(a,c){this.selector=a,this.options=c,this.clearFilter=g(this.clearFilter,this),this.dropdownClicked=g(this.dropdownClicked,this),b.__super__.constructor.apply(this,arguments),this.elm&&(this.filters=this.options.filters,this.activeFilters=[],this.handleTemplate(),this.handleFilters(),this.handleActiveFilterText())}return h(b,a),b.prototype.bindEvents=function(){return b.__super__.bindEvents.apply(this,arguments),this.dropdownInner.addEventListener("click",this.dropdownClicked),this.clear.addEventListener("click",this.clearFilter)},b.prototype.unbindEvents=function(){return b.__super__.unbindEvents.apply(this,arguments),this.dropdownInner.removeEventListener("click",this.dropdownClicked),this.clear.addEventListener("click",this.clearFilter)},b.prototype.dropdownClicked=function(a){var b,c,d,f,g,h;if("INPUT"===a.target.tagName){for(this.activeFilters=[],h=this.inputElms,d=c=0,g=h.length;c<g;d=++c)f=h[d],f.checked&&(b=f.value,e.isNumber(b)&&(b=parseInt(b)),this.activeFilters.push(b));return this.handleActiveFilterText(),0!==this.activeFilters.length?("radio"===this.options.type&&(this.hideFilters(),this.activeFilters=this.activeFilters[0]),this.options.onFilterApplied(this.activeFilters)):this.options.onFilterCleared()}},b.prototype.clearFilter=function(a){var c,d,e,f,g;for(a.preventDefault(),this.activeFilters=[],this.handleActiveFilterText(),g=this.inputElms,d=c=0,f=g.length;c<f;d=++c)e=g[d],e.checked=!1;return b.__super__.clearFilter.apply(this,arguments)},b.prototype.handleTemplate=function(){return b.__super__.handleTemplate.apply(this,arguments),this.filterSnippet='<label class="sift-label">\n <input type="'+this.options.type+'" name="{{name}}" value="{{value}}" {{checked}}>\n <span>{{displayName}}</span>\n</label>',this.handleInitialRender()},b.prototype.handleFilters=function(){var a,b,c,d,f,g,h,i,j;for(d="",j=this.filters,g=f=0,h=j.length;f<h;g=++f)b=j[g],a="",this.options.activeFilter&&(i="object"==typeof this.options.activeFilter,i?"radio"!==this.options.type?(c=e.where(null,b.value,this.options.activeFilter),c&&(a="checked",this.activeFilters.push(b.value))):console.warn("Can't have multiple active filters for radio buttons"):(e.isNumber(this.options.activeFilter)&&(this.options.activeFilter=parseInt(this.options.activeFilter)),this.options.activeFilter===b.value&&(a="checked",this.activeFilters.push(b.value)))),d+=this.filterSnippet.replace("{{displayName}}",b.displayName).replace("{{name}}",this.options.displayName).replace("{{value}}",b.value).replace("{{checked}}",a);return this.render(this.dropdownInner,d),this.inputElms=this.dropdownInner.getElementsByTagName("input")},b.prototype.handleActiveFilterText=function(){var a,b,c,d,f,g;if(0!==this.activeFilters.length){for(a="",this.render(this.filterName,this.options.displayName+":"),g=this.activeFilters,d=c=0,f=g.length;c<f;d=++c)b=g[d],0!==d&&(a+=", "),e.isNumber(b)&&(b=parseInt(b)),a+=e.where("value",b,this.filters)[0].displayName;return this.render(this.activeFilterText,a),e.addClass("with-active-filter",this.elm)}return this.render(this.filterName,""+this.options.displayName),this.render(this.activeFilterText,""),e.removeClass("with-active-filter",this.elm)},b}(b),a=function(a){function b(a,c){var d,e;this.selector=a,this.options=c,this.clearFilter=g(this.clearFilter,this),b.__super__.constructor.apply(this,arguments),this.elm&&(this.activeDate=null!=(d=this.options.calendarOptions)?d.existingDate:void 0,this.activeDateRange=null!=(e=this.options.calendarOptions)?e.existingDateRange:void 0,this.handleTemplate(),this.handleFilters(),this.handleActiveFilterText())}return h(b,a),b.prototype.bindEvents=function(){return b.__super__.bindEvents.apply(this,arguments),this.clear.addEventListener("click",this.clearFilter)},b.prototype.unbindEvents=function(){return b.__super__.unbindEvents.apply(this,arguments),this.clear.addEventListener("click",this.clearFilter)},b.prototype.handleDateJustHooks=function(){return this.dateJust.options.onDateSelected=function(a){return function(b){return a.activeDate=b,a.activeDateRange=null,a.handleActiveFilterText(),a.options.onFilterApplied(b)}}(this),this.dateJust.options.onDateRangeSelected=function(a){return function(b,c){return a.activeDate=null,a.activeDateRange=[b,c],a.handleActiveFilterText(),a.options.onFilterApplied(b,c)}}(this)},b.prototype.handleDateRangeHooks=function(){return this.dateRange.options.onDateRangeSelected=function(a){return function(b,c){return a.activeDateRange=[b,c],a.handleActiveFilterText(),a.options.onFilterApplied(b,c)}}(this)},b.prototype.clearFilter=function(a){return a.preventDefault(),"calendar"===this.options.type?this.dateJust.reset():"multi_calendar"===this.options.type&&this.dateRange.reset(),this.activeDate=null,this.activeDateRange=null,this.handleActiveFilterText(),b.__super__.clearFilter.apply(this,arguments)},b.prototype.handleTemplate=function(){return b.__super__.handleTemplate.apply(this,arguments),this.handleInitialRender()},b.prototype.handleFilters=function(){return this.render(this.dropdownInner,'<div class="sift-calendar-wrap"></div>'),this.calendarWrap=this.dropdownInner.querySelector(".sift-calendar-wrap"),e.addClass("without-scroll",this.elm),"calendar"===this.options.type?(this.dateJust=new DateJust(this.calendarWrap,this.options.calendarOptions),this.handleDateJustHooks()):"multi_calendar"===this.options.type?(this.dateRange=new DateRange(this.calendarWrap,this.options.calendarOptions),e.addClass("with-multi-calendar",this.elm),this.handleDateRangeHooks()):void 0},b.prototype.handleActiveFilterText=function(){return this.activeDate||this.activeDateRange?(this.render(this.filterName,this.options.displayName+":"),e.addClass("with-active-filter",this.elm),this.activeDate?this.render(this.activeFilterText,this.activeDate.toDateString()):this.activeDateRange?this.render(this.activeFilterText,this.activeDateRange[0].toDateString()+" - "+this.activeDateRange[1].toDateString()):void 0):(this.render(this.filterName,""+this.options.displayName),e.removeClass("with-active-filter",this.elm),this.render(this.activeFilterText,""))},b}(b),window.Sift=d,e={extend:function(){var a,b,c,d,e,f,g;for(f=arguments[0],e=2<=arguments.length?j.call(arguments,1):[],a=0,c=e.length;a<c;a++){d=e[a];for(b in d)g=d[b],f[b]=g}return f},where:function(a,b,c){var d;if(d=[],c.filter(function(c){if("object"==typeof c){if(c[a]===b)return d.push(c)}else if(c===b)return d.push(c)}),d.length>0)return d},addClass:function(a,b){return b.classList.add(a)},removeClass:function(a,b){return b.classList.remove(a)},isNumber:function(a){return!isNaN(parseInt(a))}}}).call(this);